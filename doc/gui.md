# GUI设计

原型图：https://modao.cc/app/design/pbkb7r4osucugpli

打开crims_client的URL，首先与127.0.0.1:8000建立socket连接，随后便可发送SQL语句并接收响应来进行通信

一级选单：数据维护；数据查询；数据统计

注：以下称呼一行数据（记录）为一**条**数据

## 1. 数据维护

主要是对三张表进行增删改的操作，并且可以导入导出xls文件

+ 当在选单中选择任意一张表的时候，会向后端发送`SELECT * FROM 表名 ORDER BY 主键;`，并将接收到的json对象展示在下方的表格中
+ 每条数据最左端放一个选择框，方便多选，数据表左上方有三个按钮图标：添加，删除，编辑
  + 当没有选中任何1条数据时，「添加」按钮可以点击，其余2个按钮不可点击
    + 此时点击添加，会弹出让用户填写一条数据的文本框（一般会需要填写多个数据项，根据不同的表而不同，这个写死在代码或者配置文件中）
    + 填写完毕若点击「添加」，则向后端发送`INSERT (VALUE_LIST) INTO 表名;`的语句；若点击取消则取消添加。
  + 当选中了多条数据时，「删除」按钮可以点击，其余2个按钮不可点击
    + 此时点击删除，会弹出确认框「是否确认删除这X条数据？」，用户选择「删除」（红色背景按钮）或者「取消」（灰色背景按钮）
    + 填写完毕若点击「删除」，则向后端发送`DELETE FROM 表名 WHERE 主键=主键值;`的语句，这里不同的表的主键参考api文档
  + 当选中了1条数据时，「编辑」按钮可以点击，其余2个按钮不可点击
    + 此时点击编辑，会弹出让用户填写一条数据的文本框，样式类似于上述「添加」按钮弹出的文本框，但是预先上面会填好本条数据，之后用户选择「保存」（蓝色背景按钮）或者「取消」（灰色背景按钮）。
+ 当成功执行了添加，删除，编辑任意一种操作之后，都要再执行一次`SELECT * FROM 表名;`的语句，来更新当前展示的数据
+ 导出：即将当前表的数据导出为xls文件，当左侧未选择哪一张表格时「导出」按钮不可点击
+ 导入：弹出文件资源管理器，选择一个本地的xls文件导入，前端解析并生成`INSERT`语句（细节TODO）

### 表逻辑

1. 车辆类型信息表

表名: CAR_TYPE

| 字段名   | 显示名称     | 对应JS类型 | 备注                                      |
| -------- | ------------ | ---------- | ----------------------------------------- |
| code     | 车辆类型编码 | string     | **主键**，只能是整数型的字符串，从'1'开始 |
| tname    | 车辆类型名称 | string     |                                           |
| quantity | 库存数量     | number     | 只能是非负整数                            |

2. 车辆基本信息表

表名: CAR_INFO

| 字段名     | 显示名称     | 对应JS类型 | 备注                            |
| ---------- | ------------ | ---------- | ------------------------------- |
| cid        | 车辆编号     | number     | **主键**，只能是非负整数        |
| plate      | 车牌号       | string     |                                 |
| code       | 车辆类型编码 | string     | 只能是整数型的字符串，从'1'开始 |
| cname      | 车辆名称     | string     |                                 |
| gear       | 排挡方式     | string     |                                 |
| daily_rent | 每日租金     | number     | 浮点数                          |
| rent       | 出租状态     | string     | 只能在'y'和'n'两者之间选择      |

**当添加一个车辆信息时，要将CAR_TYPE表对应类型数量+1**

3. 租车订单信息表

| 字段名                 | 显示名称     | 对应JS类型 | 备注                                                         |
| ---------------------- | ------------ | ---------- | ------------------------------------------------------------ |
| oid                    | 订单编号     | string     | **主键**，不允许用户填写，如“2019021505”表示2019年2月15日第5个订单 |
| identity_number        | 身份证号     | string     |                                                              |
| pname                  | 客人姓名     | string     |                                                              |
| phone_number           | 手机号码     | string     | 只能是由0-9组成的字符串                                      |
| cid                    | 租用车辆编号 | number     | 只能是非负整数                                               |
| pickup_time            | 取车时间     | Date       | 只精确到分钟，SQL语句的时间格式为"%Y-%m-%d/%H:%M"            |
| scheduled_dropoff_time | 预约还车时间 | Date       | 只精确到分钟，SQL语句的时间格式为"%Y-%m-%d/%H:%M"            |
| deposit                | 押金         | number     | 不允许用户填写，=应缴费用*5                                  |
| actual_dropoff_time    | 实际还车时间 | Date       | 只精确到分钟，SQL语句的时间格式为"%Y-%m-%d/%H:%M"            |
| scheduled_fee          | 应缴费用     | number     | 浮点数                                                       |
| actual_fee             | 实缴缴用     | number     | 浮点数                                                       |

### SQL语法示例

一般情况下，本模块（数据维护）仅需要以下SQL语句：

```sql
--查询整张表
SELECT * FROM CAR_TYPE ORDER BY code;
SELECT * FROM CAR_INFO ORDER BY cid;
SELECT * FROM RENT_ORDER ORDER BY oid;

--删除某条数据, 只需要按照主键删除即可
DELETE FROM CAR_TYPE WHERE code='这条数据的code';
DELETE FROM CAR_INFO WHERE cid='这条数据的cid';
DELETE FROM RENT_ORDER WHERE oid='这条数据的oid';

--插入一条数据, 需要把所有数据处理/拼接好, 括号中的参数顺序就是上文的表格从上到下的顺序
INSERT INTO CAR_TYPE VALUES ('6', '跑车', 100);
INSERT INTO CAR_INFO VALUES (100, '琼B12345', '6', '保时捷', '自动挡', 1000, 'n');
INSERT INTO CAR_INFO VALUES (2020061101, '42011011110', '王思聪', '13912345678', 100, '2020-06-11/00:00', '2020-06-11/18:00', 10000, '2020-06-11/19:00', 2000, 2000);

--修改一条数据, 首先根据主键删除这条数据, 然后再插入即可😂
```

## 2. 数据查询

数据查询分为普通查询和高级查询，默认情况为普通查询，通过点击按钮可切换到高级查询

### 普通查询

首先需要选择一张表，然后根据表的不同，下方会出现不同的子选项（见原型图），根据类型有文本框型（数字/文本）和选项型（比如车辆类别），点击「查询」按钮后，前端根据用户填写情况来拼接SQL语句发送给后端，随后下方出现查找结果（如果查找结果为空要给出提示，比如弹窗「未查找到结果」等）

### 高级查询

高级查询无需选择表，直接让用户在文本框中输入SQL语句，点击「查询」即直接发送SQL语句去查询。这里由于用户输入语法可能会有问题，所以后端可能会报错，需要特殊判断：如果报错了就提示用户。

### 导出查询结果

不管是普通查询还是高级查询，都可以随时将当前查到的结果导出为xls文档。（同上，细节TODO）

## 3. 数据统计

总共只要求4种数据统计图，因此考虑SQL查询语句直接写死，条形图的格式也分别写一个（细节TODO）